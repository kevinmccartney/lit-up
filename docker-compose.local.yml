services:
  api:
    image: python:3.13-slim
    working_dir: /workspace/projects/api
    volumes:
      - ./:/workspace
      # Exclude host .venv - container will create its own Linux-compatible venv
      - /workspace/projects/api/.venv
    environment:
      AWS_REGION: us-east-1
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-}
      AWS_SESSION_TOKEN: ${AWS_SESSION_TOKEN:-}
      CONFIG_TABLE_NAME: lit-up-dev-configs
    ports:
      - '3000:3000'
      - '5890:5890'
    command: >
      bash -lc "
      pip install --no-cache-dir uv &&
      cd /workspace/projects/api &&
      uv venv --python 3.13 &&
      uv sync &&
      uv run python -m debugpy --listen 0.0.0.0:5890 server.py
      "

  ui:
    image: node:20-alpine
    working_dir: /workspace/projects/ui
    volumes:
      - ./:/workspace
    ports:
      - '5173:5173'
    environment:
      CHOKIDAR_USEPOLLING: 'true'
    command: >
      sh -lc
      "npm ci && npm run dev -- --host 0.0.0.0 --port 5173"
